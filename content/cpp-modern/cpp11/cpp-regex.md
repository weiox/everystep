---
title: 'std::regex：正则表达式（以及它的坑）'
description: 'C++11 把正则搬进标准库：regex/search/match 统一接口很方便，但你也得知道它的性能与实现差异，别把它当银弹。'
---

正则这东西。

在 C++ 里一直有点尴尬。

不是因为它不重要。

是因为它一旦重要。

就容易变成性能事故。

C++11 把 `std::regex` 放进标准库。

从接口上看。

它很像你在别的语言里见过的正则。

```cpp
#include <regex>

std::regex re(R"(\d{4}-\d{2}-\d{2})");
```

你可以 search。

```cpp
std::smatch m;
if (std::regex_search(s, m, re)) {
    // m[0] 是匹配到的子串
}
```

也可以 match（全串匹配）。

```cpp
if (std::regex_match(s, re)) {
}
```

这部分都挺直观。

## 真正的坑在性能

std::regex 的实现。

在不同标准库里差异很大。

历史上也确实出现过。

“同一段正则在某个实现里慢得离谱”的情况。

所以我对 std::regex 的态度一直很保守。

小规模。

偶尔用。

很方便。

热路径。

大规模文本。

我会先想别的办法。

比如手写解析。

比如用更可控的库。

## 另一个坑：regex 不是 parser

很多人拿正则去解析嵌套结构。

比如 JSON。

比如 HTML。

看起来能凑。

但维护起来很痛。

你会发现。

bug 不是出在逻辑。

而是出在“正则读不懂”。

## 小洞见

std::regex 的价值是标准接口。

但它不是银弹。

你用它。

最好是。

你知道你的输入规模。

你知道你的性能预算。

你也愿意在必要时换实现。

否则。

你可能只是把一段复杂逻辑。

藏进了一段更难读的字符串里。
